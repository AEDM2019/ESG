<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ESG 설문조사</title>
<style>
  :root{
    --bg:#0b1020; --card:#121a2f; --ink:#e8eefc; --muted:#aab7d4; --accent:#6aa6ff;
    --ok:#2bb673; --warn:#ffb020; --bad:#ff5a6a; --border:#223; 
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,Segoe UI,Roboto,Apple SD Gothic Neo,Apple Color Emoji,EmojiOne}
  .wrap{max-width:880px;margin:24px auto;padding:20px}
  .card{background:var(--card);border:1px solid var(--border);border-radius:16px;box-shadow:0 6px 24px rgba(0,0,0,.25);padding:20px}
  h1{margin:0 0 8px;font-size:22px}
  .sub{color:var(--muted);margin:0 0 16px}
  label{display:block;margin:10px 0 6px;font-weight:600}
  input[type="text"]{width:100%;padding:12px 14px;border-radius:10px;border:1px solid var(--border);background:#0f162a;color:var(--ink)}
  .q{padding:16px;border:1px solid var(--border);border-radius:14px;margin:12px 0;background:rgba(255,255,255,0.02)}
  .q h3{margin:0 0 10px;font-size:16px}
  .opts{display:grid;gap:8px}
  .opt{display:flex;align-items:center;gap:8px;padding:8px;border:1px solid var(--border);border-radius:10px;cursor:pointer}
  .opt input{transform:scale(1.1)}
  .score-pill{margin-left:auto;font-size:12px;padding:2px 8px;border-radius:999px;background:#0f1b38;color:#cfe0ff;border:1px solid #2a3b66}
  .cat{display:inline-block;font-size:12px;padding:2px 8px;border-radius:999px;border:1px solid var(--border);color:#b9c7e6;margin-bottom:8px}
  .E{background:#0f2a1b;border-color:#214d37;color:#c6f1db}
  .S{background:#2a1b0f;border-color:#5a3b20;color:#ffdcb6}
  .G{background:#1b0f2a;border-color:#3d285a;color:#e5c6ff}
  .row{display:flex;gap:10px;flex-wrap:wrap}
  .row > *{flex:1 1 260px}
  .btns{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
  button{border:1px solid var(--border);background:var(--accent);color:white;padding:12px 16px;border-radius:12px;font-weight:700;cursor:pointer}
  button.ghost{background:transparent;color:#cfe0ff}
  button:disabled{opacity:.6;cursor:not-allowed}
  .result{margin-top:16px;border:1px dashed var(--border);border-radius:14px;padding:12px}
  table{width:100%;border-collapse:collapse;margin-top:8px}
  th,td{padding:8px;border-bottom:1px solid #223;text-align:left;font-size:14px}
  .totals{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-top:8px}
  .pill{padding:10px;border:1px solid var(--border);border-radius:12px;background:#0f162a}
  .ok{color:var(--ok)} .warn{color:var(--warn)} .bad{color:var(--bad)}
  .note{color:var(--muted);font-size:12px;margin-top:8px}
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h1>ESG 설문조사</h1>
    <p class="sub">작성자 이름을 입력하고 각 문항에 응답하세요. 선택한 즉시 <b>문항별 점수</b>가 표시됩니다. 제출하면 응답이 구글 스프레드시트에 저장됩니다.</p>

    <div class="row">
      <div>
        <label for="name">작성자 이름</label>
        <input id="name" type="text" placeholder="이름을 입력하세요" autocomplete="name">
      </div>
    </div>

    <div id="questions"></div>

    <div class="btns">
      <button id="checkBtn" class="ghost">점수 확인</button>
      <button id="submitBtn" disabled>제출하기</button>
    </div>

    <div id="result" class="result" style="display:none"></div>
    <p class="note">개인정보는 이름과 응답만 수집되며, 수업 목적 이외로 사용하지 않습니다.</p>
  </div>
</div>

<script>
/** ① Google Apps Script 웹앱 URL (②에서 발급받은 URL로 교체) */
const GAS_URL = "https://script.google.com/macros/s/AKfycbxaEcINk1_rXg1R59tgO3o5qozP1XmgHP1OKx5jxDl3hhH1yM7yNEiBfwWQUi2tyzOpLA/exec";

/** ② 설문 문항/점수 구성
 * - category: 'E' | 'S' | 'G'
 * - options: {label, score}로 문항별 점수 정의
 * - 필요 시 문항 계속 추가 가능
 */
const QUESTIONS = [
  // Environment (예시)
  { id:"E1", category:"E", text:"차로 1km 거리를 대중교통을 이용한다.", 
    options:[{label:"항상 그렇다",score:2},{label:"가끔 그렇다",score:1},{label:"거의 하지 않는다",score:0}] },
  { id:"E2", category:"E", text:"개인 텀블러를 사용한다.", 
    options:[{label:"항상 사용",score:2},{label:"가끔 사용",score:1},{label:"사용 안 함",score:0}] },
  { id:"E3", category:"E", text:"일회용품 사용을 줄이고 다회용품을 사용한다.",
    options:[{label:"다회용 위주",score:2},{label:"반반",score:1},{label:"일회용 위주",score:0}] },

  // Social (예시)
  { id:"S1", category:"S", text:"지난 1년간 교내 봉사활동에 참여한 시간은?",
    options:[{label:"10시간 이상",score:2},{label:"1~9시간",score:1},{label:"없음",score:0}] },
  { id:"S2", category:"S", text:"교내 모임/프로그램(동아리/행사 등) 참여 빈도는?",
    options:[{label:"월 2회 이상",score:2},{label:"월 1회",score:1},{label:"거의 없음",score:0}] },
  { id:"S3", category:"S", text:"사회적 이슈에 대한 토론 경험이 있었습니까?",
    options:[{label:"자주 있었다",score:2},{label:"가끔 있었다",score:1},{label:"없었다",score:0}] },

  // Governance (예시)
  { id:"G1", category:"G", text:"과제 제출기한을 잘 지키는가?",
    options:[{label:"항상 지킴",score:2},{label:"대체로 지킴",score:1},{label:"자주 늦음",score:0}] },
  { id:"G2", category:"G", text:"토론/발표 수업에서 의견을 명확히 표현하는가?",
    options:[{label:"항상 그렇다",score:2},{label:"가끔 그렇다",score:1},{label:"거의 없다",score:0}] },
  { id:"G3", category:"G", text:"수업자료를 충분히 읽고 발표 수업에 참여하는가?",
    options:[{label:"항상 그렇다",score:2},{label:"가끔 그렇다",score:1},{label:"거의 없다",score:0}] },
];

/** ③ 렌더링 */
const $qWrap = document.getElementById('questions');
QUESTIONS.forEach((q, idx) => {
  const box = document.createElement('div');
  box.className = 'q';
  const cat = document.createElement('div');
  cat.className = 'cat ' + q.category;
  cat.textContent = q.category === 'E' ? 'Environment'
                    : q.category === 'S' ? 'Social' : 'Governance';
  const h = document.createElement('h3');
  h.textContent = `${idx+1}. ${q.text}`;
  const opts = document.createElement('div');
  opts.className = 'opts';
  q.options.forEach((op, oi) => {
    const id = `${q.id}_${oi}`;
    const label = document.createElement('label'); label.className = 'opt';
    const input = document.createElement('input'); input.type='radio';
    input.name = q.id; input.value = op.score; input.id = id;
    const span = document.createElement('span'); span.textContent = op.label;
    const score = document.createElement('span'); score.className='score-pill'; score.textContent = `점수: ${op.score}`;
    label.appendChild(input); label.appendChild(span); label.appendChild(score);
    opts.appendChild(label);
  });
  box.appendChild(cat); box.appendChild(h); box.appendChild(opts);
  $qWrap.appendChild(box);
});

/** ④ 점수 계산/표시 */
function collect() {
  const name = document.getElementById('name').value.trim();
  const answers = [];
  let done = true;
  let totals = {E:0,S:0,G:0, ALL:0};

  QUESTIONS.forEach(q => {
    const sel = document.querySelector(`input[name="${q.id}"]:checked`);
    if(!sel) { done = false; }
    const score = sel ? Number(sel.value) : null;
    if(score!=null){
      totals[q.category] += score;
      totals.ALL += score;
    }
    answers.push({
      id:q.id, category:q.category, text:q.text,
      option: sel ? sel.parentElement.querySelector('span').textContent : null,
      score
    });
  });

  return { name, answers, done, totals };
}

function renderResult() {
  const {name, answers, totals, done} = collect();
  const $res = document.getElementById('result');
  $res.style.display = 'block';
  let rows = answers.map((a,i)=>`
    <tr>
      <td>${i+1}</td>
      <td>${a.category}</td>
      <td>${a.text}</td>
      <td>${a.option ?? '-'}</td>
      <td>${a.score ?? '-'}</td>
    </tr>
  `).join('');

  $res.innerHTML = `
    <b>점수 요약${name?` — ${name}`:''}</b>
    <div class="totals">
      <div class="pill">E 합계: <b>${totals.E}</b></div>
      <div class="pill">S 합계: <b>${totals.S}</b></div>
      <div class="pill">G 합계: <b>${totals.G}</b></div>
      <div class="pill">총점: <b>${totals.ALL}</b></div>
    </div>
    <table>
      <thead><tr><th>#</th><th>분류</th><th>문항</th><th>선택</th><th>점수</th></tr></thead>
      <tbody>${rows}</tbody>
    </table>
    ${!done?'<p class="warn">모든 문항에 응답하면 제출할 수 있습니다.</p>':''}
  `;
}

document.getElementById('checkBtn').addEventListener('click', renderResult);

/** ⑤ 전체 응답 완료 여부에 따라 제출버튼 활성화 */
function updateSubmitState(){
  const {name, done} = collect();
  document.getElementById('submitBtn').disabled = !(name && done);
}
document.addEventListener('input', updateSubmitState);

/** ⑥ 제출 → Google Apps Script로 전송 */
document.getElementById('submitBtn').addEventListener('click', async () => {
  const payload = collect();
  if(!payload.name){ alert('이름을 입력하세요.'); return; }
  if(!payload.done){ alert('모든 문항에 응답해주세요.'); return; }

  try{
    const res = await fetch(GAS_URL, {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({
        name: payload.name,
        answers: payload.answers,
        totals: payload.totals,
        submittedAt: new Date().toISOString()
      })
    });
    const data = await res.json();
    if(data?.ok){
      renderResult();
      alert('제출이 완료되었습니다!');
    }else{
      console.error(data);
      alert('저장 중 오류가 발생했습니다. 다시 시도하세요.');
    }
  }catch(e){
    console.error(e);
    alert('네트워크 오류가 발생했습니다.');
  }
});
</script>
</body>
</html>

